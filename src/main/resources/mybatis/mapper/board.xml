<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.mapper.board">
	
	
	<select id="selectByBno" parameterType="int" resultType="board">
		select bno, btitle, bcontent, bdate, memail, to_char(bdate, 'YYYY-MM-DD HH24:Mi:SS') bdate, murl, blike
		from board
		where bno = #{bno}
	</select>
	
	<!-- 영아 - 보드 게시물 / url & cno 가 맞을 때 -->
	<select id="categoryListLink"  parameterType="map"  resultType="board">
			select bno, btitle, bcontent, bdate, bimage, c.cno, c.ccontent, b.murl
			from board b, category c
			where c.cno=b.cno and b.murl=#{murl} and c.cno=#{cno}
			order by bdate desc
	</select>
	
	<select id="selectBLikeList" parameterType="String" resultType="board">
		select bno, btitle, bcontent, bdate, blike, murl
		from ( select bno, btitle, bcontent, bdate, murl, blike
		from board 
		order by blike desc) 
		where murl=#{murl} and rownum &lt;=4
		</select>	 	
		
	<!-- 영아 - 나의 블로그 내 좋아요 순 상위 4개 게시물 리스트
		<select id="selectBLikeList" parameterType="String" resultType="board">
		select btitle, blike
		from ( select btitle, blike
		from board 
		order by blike desc) 
		where murl=#{murl} and rownum &lt;=4
		</select> -->
		
	<!-- 영아 - 나의 블로그 내 좋아요 순 상위 4개 게시물 리스트 링크 연결 
			<select id="bLikeListLink" parameterType="String" resultType="category">	
			select distinct c.cno, c.ccontent, m.murl
			from category c, board b, member m
			where b.cno = c.cno and m.memail = b.memail and m.murl=#{murl}
		</select> -->

	
<!-- 선: 좋아요 순으로 불러오기 ranking 총 데이터 -->
		<!-- 좋아요순은 데이터 12개 -->
	<select id="selectLikeAll" resultType="board">	
		select rownum as rnum,  bno, btitle, bcontent, bdate, blike, cno, bimage, mnickname, mmyimage, mintro
		from(select bno, btitle, bcontent, bdate, blike, cno, bimage, mnickname, mmyimage, mintro
       			 from board b, member m
       			 where b.memail = m.memail
       			 order by blike desc)
		where rownum &lt;= 12
	</select>
	
	<!-- 선: 좋아요 순으로 불러오기 ranking 카테고리별 데이터 -->
	<!-- 좋아요순은 데이터 12개 -->
	<select id="selectLikeCategory" parameterType="int" resultType="board">
		select rownum as rnum,  bno, btitle, bcontent, bdate, blike, cno, bimage, mnickname, mmyimage, mintro
		from(select bno, btitle, bcontent, bdate, blike, cno, bimage, mnickname, mmyimage, mintro
       			 from board b, member m
       			 where b.memail = m.memail and cno = #{cno} 
       			 order by blike desc)
		where rownum &lt;= 12
	</select>
	
	<!-- 선: 최신순으로 불러오기 contents 총 데이터 -->
	<!-- 최신순은 나와야되는 데이터 수 제한없음 -->
	<select id="selectNewAll" resultType="board">	
	  	 select bno, btitle, REGEXP_REPLACE(bcontent, <![CDATA['<[^>]*>|\&([^;])*;']]>) as bcontent, bdate, blike, b.cno, ccontent, bimage, mnickname, mmyimage, mintro
         from board b, member m, category c
       	 where b.memail = m.memail and b.cno = c.cno
       	 order by bdate desc
	</select>
	
	<!-- 선: 최신순으로 불러오기 contents 카테고리별 데이터 -->
	<!-- 최신순은 나와야되는 데이터 수 제한없음 -->
	<select id="selectNewCategory" parameterType="int" resultType="board">
		select bno, btitle, REGEXP_REPLACE(bcontent, <![CDATA['<[^>]*>|\&([^;])*;']]>) as bcontent, bdate, blike, b.cno, ccontent, bimage, mnickname, mmyimage, mintro
       	from board b, member m, category c
       	where b.memail = m.memail and b.cno = #{cno} and b.cno = c.cno 
       	order by bdate desc
	</select>
	
	
	<!-- ******* 지우지마라 김지훈 작성 --><!-- ******* 지우지마라 김지훈 작성 --><!-- ******* 지우지마라 김지훈 작성 --><!-- ******* 지우지마라 김지훈 작성 --><!-- ******* 지우지마라 김지훈 작성 -->
	<!-- <select id="selectUserBoard" parameterType="String" resultType="board">
		select bno,btitle, bcontent, bdate, blike, bimage, mnickname
		from board, member
		where board.memail = member.memail AND board.memail = #{memail} 
		order by bdate desc
	</select> -->
		
		
		<select id="selectUserBoard" parameterType="String" resultType="board">
		<!-- select bno,btitle, bcontent, bdate, blike, bimage, mnickname, member.murl, category.ccontent
		from board, member, category
		where member.murl = #{Murl} AND member.memail = board.memail AND category.cno = board.cno
		order by bdate desc -->
	
		<!-- blog리스트에 댓글 갯수를 출력하기 위한 서브쿼리 추가 (김지훈) 지우지마 제발  -->
		select board.bno, btitle, bcontent, bdate, blike, bimage, mnickname,
		member.murl, category.ccontent, comments.commentnum
		from board, member, category, (select count(b.bno) commentnum , b.bno
		from board b, reply r
		where b.bno = r.bno (+)
		group by b.bno) comments
		where member.murl = #{Murl} AND member.memail = board.memail AND
		category.cno = board.cno AND
		comments.bno = board.bno
		order by bdate desc
		
		</select>
		
			<!-- ******* 지우지마라 김지훈 작성 --><!-- ******* 지우지마라 김지훈 작성 --><!-- ******* 지우지마라 김지훈 작성 -->			


	<select id="countAll" resultType="int">
		select count(*) 
		from board
	</select>
	

	<select id="selectBoardComment" parameterType="int" resultType="reply">
		<!-- select distinct rno, rcontent, reply.memail, , rdate
		from board, reply, member
		where board.bno = reply.bno AND board.bno = #{bno} AND reply.memail = member.memail -->
      
        select  rno, rcontent, reply.memail,  rdate, member.mnickname, member.murl, board.bno
		from board, reply, member
		where board.bno = reply.bno AND board.bno = #{bno} AND member.memail = reply.memail
	</select>
	
<!-- 선명- mybloglist에서 게시글 관리에서 데이터 불러오기-->
	
	<select id="selectAll" parameterType="String" resultType="board">
		select c.ccontent, b.bno, b.btitle, b.bdate, b.blike, b.memail
		from category c, board b
		where b.cno = c.cno and b.memail = #{memail}
		order by b.bdate desc
	</select>
	
	
	<!-- 선명 - 페이지별로 목록 불러오기   --> 
	<select id="selectByPage" parameterType="pager" resultType="board">
		select ccontent, rnum, bno, btitle, bdate, blike, murl
		from (select rownum as rnum, ccontent, bno, btitle, bdate, blike, murl
		      from (select ccontent, bno, btitle, bdate, blike, murl
		            from category c, board b
		            where b.cno = c.cno and b.murl = #{murl}
		            order by bdate desc
		                )
		      where rownum &lt;=#{endRowNo}
		        )
		where rnum &gt;=#{startRowNo}
	</select>  

	<select id="myBoardCount" parameterType="String" resultType="int">
		select count(*)
		from board
		where murl = #{murl}
	</select>
	
	<insert id="insert" parameterType="board">
		insert into board(cno, bno, btitle, bcontent, bdate, memail, blinkcontent, murl, blike, bimage)
		values (#{cno}, seq_board_bno.nextval, #{btitle}, #{bcontent}, sysdate, #{memail}, #{blinkcontent}, #{murl}, #{blike}, #{bimage})
	</insert>

<!--  
		<select id="commentinsert" parameterType="reply">
		
			<selectKey order="BEFORE" resultType="int" keyProperty="rno">
			 select seq_reply_rno.nextval from dual
			</selectKey>
		
			insert into reply (rno, rcontent, firstcomment, memail, bno, rdate)
				values(seq_reply_rno.currval, #{rcontent}, #{firstcomment}, #{bno}, sysdate)
		</select>
-->

<!--  댓글 입력값 -->
	<insert id="commentinsert" parameterType="reply">
		insert into reply(rno, rcontent, firstcomment, memail, bno, rdate)
		values (seq_reply_rno.nextval, #{rcontent}, 0, #{memail}, #{bno}, sysdate)
	</insert>
<!--  댓글 입력 -->	

	
<!--  게시글 삭제 -->
	<delete id="deleteByBno" parameterType="int">
		delete from board where bno=#{bno}
	</delete>

	<delete id="commentDelete" parameterType="int">
		delete from reply where rno=#{rno}
	</delete>
	
</mapper>

